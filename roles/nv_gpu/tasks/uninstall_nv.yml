---
- name: Delete the OperatorHub subscription for the GPU Operator
  command: oc delete -f "{{ gpu_operator_operatorhub_sub }}"
  ignore_errors: true

- name: Get the name of the GPU Operator ClusterServiceVersion
  shell: oc get ClusterServiceVersion -n openshift-operators -oname | grep gpu-operator
  register: operator_csv_name
  ignore_errors: true

- name: Delete the ClusterServiceVersion of the GPU Operator
  with_items: "{{ operator_csv_name.stdout_lines }}"
  shell: "oc delete {{ item }} -n openshift-operators"
  #ignore_errors: true
  when: operator_csv_name.rc == 0

- name: Delete the clusterPolicy CRD of the GPU Operator
  command: oc delete -f "{{ gpu_operator_crd }}"
  ignore_errors: true

- name: Delete the namespace of the GPU Operator
  command: oc delete -f "{{ gpu_operator_namespace }}"
  ignore_errors: true
